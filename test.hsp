randomize
	screen 0, 800, 600
	title "step2-3"

	buffer 1
	picload "test.png"
	gsel 0

	font "", 20
	x = 5	// X���W
	y = 5	// Y���W

	// �z��ϐ�[ �}�b�v ]��p�ӂ���
	dim map, 20, 20
	map(0, 0) = 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
	map(0, 1) = 1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 2) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 3) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 4) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 5) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 6) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 7) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 8) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 9) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 10) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 11) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 12) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 13) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 14) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 15) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 16) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 17) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 18) = 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	map(0, 19) = 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1

// ���C�����[�`��
*main
	redraw 0
	wait 5

	// �w�i��h��Ԃ�
	color 255, 255, 255
	boxf
	color 0, 0, 0

	gosub *draw_map
	gosub *draw_chr
	gosub *check_key

	redraw 1
	goto *main

// �}�b�v��`��
*draw_map
	x@map = 0	// X���W��ێ����邽�߂̕ϐ�
	y@map = 0	// Y���W��ێ����邽�߂̕ϐ�

	repeat length(map)
		repeat length2(map)
			// �}�b�v�f�[�^��0�̏ꍇ�n�ʂ�`��
			if map(x@map, y@map) = 0 {
				color 200, 200, 200
				pos x@map*48, y@map*48
				gcopy 1, 48,0, 48,48
			}

			// �}�b�v�f�[�^��1�̏ꍇ�ǂ�`��
			if map(x@map, y@map) = 1 {
				color 200, 200, 200
				pos x@map*48, y@map*48
				gcopy 1, 0,0, 48,48
			}
			x@map += 1
		loop
		y@map += 1 : x@map = 0
	loop
	return

// �L�����N�^�[�`��
*draw_chr
	color 0, 0, 0
	pos x*48, y*48
	mes "��"
	return

// �L�[���̓`�F�b�N
*check_key
	stick key, 15
	gosub *check_map

	// [ move ]�t���O��0�̎������ړ��\�ł�
	if move = 0 {
		if key = 1 : x -= 1 : if x < 0 : x = 0
		if key = 2 : y -= 1 : if y < 0 : y = 0
		if key = 4 : x += 1 : if x >= 48 : x = 19
		if key = 8 : y += 1 : if y >= 48 : y = 19
	}
	return

// �ǂ����邩���ׂ�
*check_map
	move = 0	// �����邩���f����t���O
	if key = 1 : a = x - 1 : b = y
	if key = 2 : a = x : b = y - 1
	if key = 4 : a = x + 1 : b = y
	if key = 8 : a = x : b = y + 1
	if key > 8 : a = x : b = y

	// �ړ����������W�ɕǂ�����ꍇ��[ move ]��1����

	if map(a, b) = 1 : move = 1
	return
